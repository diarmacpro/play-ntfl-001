# Laporan Perubahan Kode pada `new_index.php`

## Deskripsi
Perubahan dilakukan pada file `new_index.php` untuk membatasi proses approval (ACC) yang dapat dilakukan pada halaman ini. Kini, hanya proses ACC Manager (acc mg) yang dapat dijalankan. Proses ACC Finish dan proses lain tidak lagi ditangani di halaman ini. Selain itu, endpoint API untuk proses ACC Manager juga diperbarui.

## Tujuan
- Memastikan hanya proses ACC Manager yang dapat dijalankan dari halaman ini.
- Mencegah proses ACC Finish dan proses lain dilakukan dari halaman ini.
- Mengganti endpoint API lama dengan endpoint baru yang lebih sesuai.
- Menonaktifkan tombol aksi jika status bukan untuk ACC Manager.

---

## Before (Sebelum Perubahan)

- Tombol aksi dapat digunakan untuk beberapa status, termasuk ACC Finish.
- Endpoint API yang digunakan untuk update status adalah:
    ```javascript
    url: `../act.php?updateStatusBayar=${dx['id_sj']},${idPic}`
    ```
- Penanganan status pada tombol aksi tidak membedakan secara tegas antara ACC Manager dan status lain.

---

## After (Setelah Perubahan)

- Tombol aksi hanya aktif untuk status ACC Manager (`stts === '-'`). Untuk status lain, tombol otomatis disable.
- Endpoint API untuk ACC Manager diganti menjadi:
    ```javascript
    url: `https://app.weva.my.id/api/acc-mg?id_sj=${dx['id_sj']}&id_m=${idPic}`
    ```
- Penanganan status pada tombol aksi kini membedakan secara tegas, hanya status ACC Manager yang dapat diproses.

---

## Potongan Kode & Penjelasan

### Sebelum

```javascript
function btnAksiPlay(e){
  // ...existing code...
  $.ajax({
    url: `../act.php?updateStatusBayar=${dx['id_sj']},${idPic}`,
    // ...existing code...
  });
  // ...existing code...
}
```
**Penjelasan:**  
Kode di atas masih menggunakan endpoint lama dan tidak membatasi aksi hanya untuk ACC Manager.

---

### Sesudah

```javascript
function btnAksiPlay(e){
  const dx = $(e).data('d');
  const stts = sttsToChr([dx['m'],dx['w'],dx['f']]);
  // Only handle 'acc mg' (manager approval) here
  if (stts === '-') {
    // Use new API endpoint for acc mg
    $.ajax({
      url: `https://app.weva.my.id/api/acc-mg?id_sj=${dx['id_sj']}&id_m=${idPic}`,
      method: "GET",
      dataType: "json",
      success: function(d){
        // d is 0 or 1
        if (d == 1) {
          dataSj();
          dataSjBySj(dx['id_sj']);
        } else {
          alert('Gagal ACC Manager!');
        }
      },
      error: function(xhr, stts, error){
        alert('Terjadi kesalahan koneksi!');
        console.error("Error : "+error);
      }
    });
  } else {
    // For other statuses, do nothing (handled elsewhere)
  }
  // For debugging
  console.log(stts);
}
```
**Penjelasan:**  
- Tombol aksi hanya aktif untuk status ACC Manager.
- Endpoint API sudah diganti ke endpoint baru.
- Status lain tidak diproses.

---

### Penonaktifan Tombol untuk Status Selain ACC Manager

```javascript
function btnAksiOlahElement(dt){
  $('#btnAksi').data('d',dt);
  const sttsSj = btnAksiAtribut([dt.m,dt.w,dt.f]);
  $('#btnAksi').removeClass().addClass(`btn btn-${sttsSj[1]} fs-1`);
  $('#btnAksi').text(sttsSj[0]);

  // Only enable button for 'acc mg' (manager approval)
  const stts = sttsToChr([dt.m,dt.w,dt.f]);
  if (stts === '-') {
    // Enable button
    $('#btnAksi').prop('disabled', false).show();
    if ($('#txNewBtnAksi')) {
      $('#txNewBtnAksi').remove();
    }
    $('#wadahBtnAksi').removeClass('text-center bg-body-secondary border border-2 border-primary fw-bold fs-1 py-1');
  } else {
    // Disable button for other statuses
    $('#btnAksi').prop('disabled', true).show();
    if ($('#txNewBtnAksi')) {
      $('#txNewBtnAksi').remove();
    }
    $('#wadahBtnAksi').addClass('text-center bg-body-secondary mt-1 fw-bold fs-1 py-1');
  }
}
```
**Penjelasan:**  
Tombol aksi akan otomatis disable jika status bukan ACC Manager.

---

## Tindakan

- Melakukan refactor pada fungsi `btnAksiPlay` dan `btnAksiOlahElement`.
- Mengganti endpoint API pada proses ACC Manager.
- Menambahkan validasi status agar hanya ACC Manager yang dapat diproses.
- Menonaktifkan tombol aksi untuk status selain ACC Manager.

---

## Hasil / Kesimpulan

- Proses ACC Finish dan proses lain tidak lagi dapat dijalankan dari halaman ini.
- Hanya proses ACC Manager yang dapat dijalankan, sesuai kebutuhan sistem.
- Endpoint API sudah diperbarui dan siap digunakan oleh back-end.
- Tombol aksi otomatis disable jika status bukan ACC Manager, sehingga mencegah aksi yang tidak diinginkan.

---

## Contoh Pemanggilan API (Untuk Back-End)

**Endpoint:**  
```
GET https://app.weva.my.id/api/acc-mg?id_sj={ID_SJ}&id_m={ID_MANAGER}
```

**Contoh:**  
```
GET https://app.weva.my.id/api/acc-mg?id_sj=SJ12345&id_m=MG001
```

**Response:**  
- `1` : Berhasil ACC Manager
- `0` : Gagal ACC Manager

---

**Catatan:**  
Perubahan ini memastikan hanya proses ACC Manager yang dapat dilakukan dari halaman ini, sehingga keamanan dan alur bisnis lebih terjaga. Endpoint baru juga memudahkan integrasi dengan sistem back-end yang lebih modern.